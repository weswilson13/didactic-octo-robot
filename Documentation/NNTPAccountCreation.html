<!DOCTYPE html>
<html>
<head>
<title>NNTPAccountCreation.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="nnptc-nnptc-nntp-studentinstructor-account-creation"><img src="NNPTC_Logo.jpg" alt="NNPTC"> NNPTC NNTP Student\Instructor Account Creation</h1>
<p>NNTP Account Creation for Students\Instructors is a multiple step process. At high level, these are:</p>
<ol>
<li>Generate a CSV file with pertinent user information</li>
<li>Create the Windows Accounts</li>
<li>Add the users to the required AD groups</li>
<li>Enable the accounts</li>
<li>Enforce smart card login</li>
</ol>
<p>These steps are completed via 2 separate powershell scripts, the first of which is executed on the NNPP network, the second on the NNTP network.</p>
<h2 id="the-scripts">The Scripts</h2>
<h3 id="1-gettscrusers">1. GetTSCRUsers</h3>
<p>This &quot;tool&quot; is comprised of multiple scripts/files and is executed on the NNPP network. At a high level, this step queries the NOTEPAD database and generates a set of CSV files to be used in the second step, on the NNTP network, to create the accounts.</p>
<p>Launched from:</p>
<blockquote>
<p>Z:\Shared\NNPTC\W_drives\ISD\Scripts\NewUserScripts\GetTSCRUsers.lnk <img src="GetTSCRUsers_Shortcut.png" alt="GetTSCRUsers"></p>
</blockquote>
<p>the actual scripts being executed are in the NNTPAccountCreation folder and are described below:</p>
<ul>
<li>
<p><strong>GetTSCRUsers.bat</strong></p>
<ul>
<li>The batch file which initializes the user form</li>
</ul>
</li>
<li>
<p><strong>Form.ps1</strong></p>
<ul>
<li>Uses .NET classes to build the User Interface, helping to control program logic</li>
</ul>
<p><img src="Form_Default.png" alt="form"></p>
</li>
<li>
<p><strong>Get-TSCRUsers.ps1</strong></p>
<ul>
<li>Executed when student accounts are needed</li>
<li>Uses .NET classes to connect to and query the NOTEPAD database (<em>NP-NNPTC.NP.PrsnlSeawareUpload_V</em>)</li>
<li>Generates 2 csv files, one for Active Directory account creation, the other for Seaware account creation
<ul>
<li>TSCR_AD.csv</li>
<li>TSCR_SW.csv</li>
</ul>
</li>
<li>Script help or additional details may be retrieved by executing the following from a powershell prompt:</li>
</ul>
<pre class="hljs"><code><div>  <span class="hljs-built_in">Get-Help</span> <span class="hljs-string">'Z:\Shared\NNPTC\W_drives\ISD\Scripts\NewUserScripts\NNTPAccountCreation\Get-TSCRUsers.ps1'</span> <span class="hljs-literal">-Full</span>
</div></code></pre>
</li>
<li>
<p><strong>Get-TSCRInstructors.ps1</strong></p>
<ul>
<li>Executed when instructor accounts are needed</li>
<li>Uses .NET classes to connect to and query the NOTEPAD database (<em>NP-NNPTC.NP.PRSNL_PEOPLE</em>)</li>
<li>Generates 2 csv files, one for Active Directory account creation, the other for Seaware account creation
<ul>
<li>TSCR_Instructor_AD.csv</li>
<li>TSCR_Instructor_SW.csv</li>
</ul>
</li>
<li>Script help or additional details may be retrieved by executing the following from a powershell prompt:</li>
</ul>
<pre class="hljs"><code><div>  <span class="hljs-built_in">Get-Help</span> <span class="hljs-string">'Z:\Shared\NNPTC\W_drives\ISD\Scripts\NewUserScripts\NNTPAccountCreation\Get-TSCRInstructors.ps1'</span> <span class="hljs-literal">-Full</span>
</div></code></pre>
</li>
<li>
<p><strong>??GetTSCRUsers.config??</strong></p>
<ul>
<li>Application configuration settings and database connection string information</li>
</ul>
</li>
</ul>
<h3 id="2-create-nnptcstudentsps1--create-nnptcinstructorsps1">2. Create-NNPTCStudents.ps1 / Create-NNPTCInstructors.ps1</h3>
<p>Executed on the NNTP network following CSV generation.</p>
<p>Located at:</p>
<blockquote>
<p>\\ptclw16p-bu01\W_drives\ISD\Scripts</p>
</blockquote>
<p>these scripts create the Active Directory accounts, add the users to the corresponding AD groups, and have the capability to schedule account enablement and smart card enforcement.</p>
<h2 id="csv-generation-step-1">CSV Generation (Step 1)</h2>
<p>CSV generation is the first step in the account creation process and begins by executing <em>GetTSCRUsers.lnk</em>. A user form will appear, which defaults to expect an NNPTC Class as input. The textbox has an auto completion feature which uses the NOTEPAD database (<em>NP-NNPTC.NP.PrsnlClassSections</em>) as the data source.</p>
<h5 id="note-this-tool-is-locally-executed-as-such-it-is-running-in-the-context-of-the-calling-user-and-so-a-successful-connection-to-the-database-is-dependent-upon-the-user-having-the-appropriate-permissions-detailed-below">NOTE: this tool is locally executed; as such, it is running in the context of the calling user and so a successful connection to the database is dependent upon the user having the appropriate permissions (detailed below).</h5>
<p>Executing the form in this manner will call <em>Get-TSCRUsers.ps1</em> with the chosen class as script input.</p>
<p>Alternatively, the user may choose to generate a CSV by entering one or more IDs. The following combinations exist:</p>
<ul>
<li>Student by PID</li>
<li>Student by DoDID</li>
<li>Instructor by PID</li>
<li>Instructor by DoDID</li>
</ul>
<p><img src="GetTSCRUser_ByID.png" alt="Lookup User by ID"></p>
<p>DoD ID is known by most sailors and easily found in the NOTEPAD web application. PID is available to Database Admins and users with additional permissions; as such DoDID may be the best choice for most users running this program for ad-hoc account creation.</p>
<p>When ID's are used as script input (vice student class), the applicable script alters the WHERE clause of the T-SQL query to target DoDID or PID, as appropriate.</p>
<p><em>Get-TSCRUsers.ps1</em> will be executed when Student is selected; <em>Get-TSCRInstructors.ps1</em> will be executed for Instructor.</p>
<p>At the completion of either script, a couple things happen:</p>
<ul>
<li>
<p>The following .csv files are created:</p>
<ul>
<li>TSCR_AD.csv (TSCR_Instructor_AD.csv)</li>
<li>TSCR_SW.csv (TSCR_Instructor_SW.csv)</li>
<li>TSCR_<em>ClassSection</em>_AD.csv <strong>(Student Class Only)</strong></li>
<li>TSCR_<em>ClassSection</em>_SW.csv <strong>(Student Class Only)</strong></li>
</ul>
</li>
<li>
<p>All .csv files are created at:</p>
</li>
</ul>
<blockquote>
<p>Z:\Shared\NNPTC\W_drives\ISD\ScriptLogs</p>
</blockquote>
<ul>
<li>
<p>the CSVs are copied to the NNTP (if the calling user has the appropriate permissions)</p>
</li>
<li>
<p>the appropriate MicrosoftÂ® Word mail-merge files containing the NSAR and NNTP User Agreement Forms will open, at which time the user may verify accuracy, print and distribute to the account requestors.</p>
<ul>
<li>Signed NSAR and NNTP User Agreement forms should be scanned and uploaded to <a href="https://abc.de" title="Signed NSAR and NNTP User Agreements">Sharepoint</a> as soon as possible.</li>
</ul>
</li>
</ul>
<h2 id="creating-accounts-step-2">Creating Accounts (Step 2)</h2>
<p><strong>! This step requires the <em>ActiveDirectory</em> Powershell module !</strong></p>
<p>Once the corresponding CSV has been created and exported to the NNTP network, the accounts may be created in Active Directory.</p>
<p>Execute one of the following, as appropriate:</p>
<blockquote>
<p><strong>Students:</strong> \\ptclw16p-bu01\w_drives\isd\Scripts\Create-TSCRStudents.ps1<br>
<strong>Instructors:</strong> \\ptclw16p-bu01\w_drives\isd\Scripts\Create-TSCRInstructors.ps1</p>
</blockquote>
<p>The script takes input from the corresponding .csv (TSCR_AD.csv for Students, TSCR_Instructor_AD.csv for staff), looping through each line. If a user does not already exist in Active Directory, a new account is created and memberships added. If the user already exists the account is checked to ensure it has the correct description, naming convention, and temporary password.</p>
<p>(A student user may have an existing account if they are a rollback from a previous class. In this case, the AD Object description should be updated, at a minimum.)</p>
<h5 id="note-the-csvs-are-required-to-be-in-the-scripts-folder">NOTE: the CSVs are required to be in the Scripts folder</h5>
<h3 id="ad-group-memberships">AD Group Memberships:</h3>
<ul>
<li>Students
<ul>
<li>NNTP.GOV/NNTP Groups/NNPTC/NFAS-Students</li>
<li>AUKUS</li>
</ul>
</li>
<li>Instructors
<ul>
<li>NFAS-Instructors (NPS-Instructors)</li>
<li>NNPTC-NFAS-TC (NNPTC-NPS-TC)</li>
</ul>
</li>
</ul>
<h3 id="enabling-accounts-and-enforcing-smart-card-logon">Enabling Accounts and Enforcing Smart Card Logon:</h3>
<p><strong>IMPORTANT: Accounts should not be enabled until the applicable forms have been signed and turned in to ISD</strong></p>
<p>Once the accounts are created, the user has the option to schedule account enablement and smart card logon enforcement. This is dependent having the subsequent token issue scheduled.</p>
<p>If this is desired, the user will enter the date and time of the scheduled token issue. This is generally broken up by class section. Separate scheduled tasks will be created on ptclw16p-bu01, as applicable.</p>
<p>Unless specified, smart card enforcement will be scheduled to occur 2 hours following the scheduled account enablement task.</p>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="file-system-permissions">File System Permissions</h3>
<p>On the NNPP network, the calling user needs to have <em>Read/Execute</em> permission on the script files, as well as <em>Write</em> permission to the CSV location in the Scriptlogs folder.</p>
<h3 id="active-directory-permissions">Active Directory Permissions</h3>
<p>The user executing the scripts on the NNTP network should have Create Object permission on the appropriate OU's, at a minimum.</p>
<p>Ideally, this step should be completed using an NNTP Server Admin account.</p>
<h3 id="required-database-permissions">Required Database Permissions</h3>
<p>In order to execute the embedded T-SQL queries against the NOTEPAD databse, the calling user must have <strong>SELECT</strong> permission on the following database objects:</p>
<ul>
<li>NP.PrsnlSeawareUpload_V</li>
<li>NP.Prsnl????????_V</li>
<li>NP.PRSNL_PEOPLE</li>
<li>NP.PrsnlOrgAssignments</li>
<li>NP.PrsnlClasses</li>
<li>Core.Hierarchies</li>
</ul>

</body>
</html>
